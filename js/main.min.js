let restaurants,neighborhoods,cuisines
var staticMapUrl;var markers=[]
document.addEventListener('DOMContentLoaded',(event)=>{updateRestaurants();fetchNeighborhoods();fetchCuisines()});fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((error,neighborhoods)=>{if(error){console.error(error)}else{self.neighborhoods=neighborhoods;fillNeighborhoodsHTML()}})}
fillNeighborhoodsHTML=(neighborhoods=self.neighborhoods)=>{const select=document.getElementById('neighborhoods-select');neighborhoods.forEach(neighborhood=>{const option=document.createElement('option');option.innerHTML=neighborhood;option.value=neighborhood;select.append(option)})}
fetchCuisines=()=>{DBHelper.fetchCuisines((error,cuisines)=>{if(error){console.error(error)}else{self.cuisines=cuisines;fillCuisinesHTML()}})}
fillCuisinesHTML=(cuisines=self.cuisines)=>{const select=document.getElementById('cuisines-select');cuisines.forEach(cuisine=>{const option=document.createElement('option');option.innerHTML=cuisine;option.value=cuisine;select.append(option)})}
updateRestaurants=()=>{const cSelect=document.getElementById('cuisines-select');const nSelect=document.getElementById('neighborhoods-select');const cIndex=cSelect.selectedIndex;const nIndex=nSelect.selectedIndex;const cuisine=cSelect[cIndex].value;const neighborhood=nSelect[nIndex].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood,(error,restaurants)=>{if(error){console.error(error)}else{resetRestaurants(restaurants);fillRestaurantsHTML();var blazy=new Blazy()}})}
resetRestaurants=(restaurants)=>{self.restaurants=[];const ul=document.getElementById('restaurants-list');ul.innerHTML='';self.markers.forEach(m=>m.setMap(null));self.markers=[];self.restaurants=restaurants}
fillRestaurantsHTML=(restaurants=self.restaurants)=>{const ul=document.getElementById('restaurants-list');const picture=document.getElementById('staticmap-picture');const source=document.createElement('source');source.media='(max-width: 400px)';source.srcset='https://maps.googleapis.com/maps/api/staticmap?center=40.722216,-73.987501&scale=1&zoom=12&size=550x350&key=AIzaSyDFOaYDK-AO0efKW6cZu9ZfD8my9_qDiks';const image=document.getElementById('staticmap');image.src='https://maps.googleapis.com/maps/api/staticmap?center=40.722216,-73.987501&scale=2&zoom=11&size=512x200&key=AIzaSyDFOaYDK-AO0efKW6cZu9ZfD8my9_qDiks';restaurants.forEach(restaurant=>{ul.append(createRestaurantHTML(restaurant));source.srcset+=`&markers=size:mid%7Ccolor:orange%7C${restaurant.latlng.lat},${restaurant.latlng.lng}`;image.src+=`&markers=size:small%7Ccolor:orange%7C${restaurant.latlng.lat},${restaurant.latlng.lng}`});picture.insertBefore(source,image)}
createRestaurantHTML=(restaurant)=>{const li=document.createElement('article');const image=document.createElement('img');image.className='restaurant-img b-lazy';image.setAttribute('role','img');image.alt=`Picture of ${restaurant.name} restaurant`;image.src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';image.setAttribute('data-src',DBHelper.imageUrlForRestaurant(restaurant,300),'300');li.append(image);const name=document.createElement('h3');name.innerHTML=restaurant.name;li.append(name);const neighborhood=document.createElement('p');neighborhood.innerHTML=restaurant.neighborhood;li.append(neighborhood);const address=document.createElement('p');address.innerHTML=restaurant.address;li.append(address);const more=document.createElement('a');more.innerHTML='View Details';more.setAttribute('role','button');more.setAttribute('aria-label','View details about '+restaurant.name);more.href=DBHelper.urlForRestaurant(restaurant);li.append(more);return li}
AppHelper.startServiceWorker()